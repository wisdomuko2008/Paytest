<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>Flexi CBT ‚Äì Payment</title>  
  
<!-- Paystack -->  
<script src="https://js.paystack.co/v1/inline.js"></script>  
  
<!-- Firebase (compat version) -->  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>  
  
<style>  
body {  
  font-family: Arial, Helvetica, sans-serif;  
  background: linear-gradient(to right, #d4f5d4, #f4f6f4);  
  display: flex;  
  justify-content: center;  
  align-items: center;  
  height: 100vh;  
  margin: 0;  
}  
.container {  
  background: #fff;  
  padding: 30px 25px;  
  width: 100%;  
  max-width: 420px;  
  border-radius: 12px;  
  box-shadow: 0 12px 30px rgba(0,0,0,0.15);  
  text-align: center;  
}  
h2 {  
  color: #0b6623;  
  margin-bottom: 10px;  
}  
p {  
  margin-bottom: 20px;  
}  
input {  
  width: 100%;  
  padding: 12px;  
  margin: 12px 0;  
  border-radius: 8px;  
  border: 1px solid #ccc;  
  font-size: 16px;  
}  
button {  
  width: 100%;  
  padding: 12px;  
  background: #0b6623;  
  color: white;  
  border: none;  
  border-radius: 8px;  
  font-size: 16px;  
  font-weight: bold;  
  cursor: pointer;  
  transition: 0.3s;  
}  
button:hover {  
  opacity: 0.9;  
}  
.status {  
  margin-top: 15px;  
  font-weight: bold;  
}  
</style>  
  
</head>  
<body>  
  
<div class="container">  
  <h2>CBT Access Payment</h2>  
  <p>Pay <b>‚Ç¶500</b> to unlock the CBT exam</p>  
  
  <input type="tel" id="whatsapp" placeholder="WhatsApp Number e.g. 0803xxxxxxx">  
  
  <button id="payBtn">Pay ‚Ç¶500</button>  
  
  <div class="status" id="status"></div>  
</div>  
  
<script>  
  // ===== FIREBASE INIT =====  
  const firebaseConfig = {
  apiKey: "AIzaSyCPumFid5YNTWug52q2VDtSDQTLU9REgss",
  authDomain: "flexi-tutors.firebaseapp.com",
  projectId: "flexi-tutors",
  storageBucket: "flexi-tutors.appspot.com",
  messagingSenderId: "320176672406",
  appId: "1:320176672406:web:90f19511241e51c6437cb7",
};
  
  firebase.initializeApp(firebaseConfig);  
  const db = firebase.firestore();  
  
  // ===== PAY FUNCTION =====  
  function pay() {  
    const whatsapp = document.getElementById("whatsapp").value.trim();  
    const status = document.getElementById("status");  
  
    if (!whatsapp) {  
      status.textContent = "‚ùå Enter your WhatsApp number";  
      return;  
    }  
  
    status.textContent = "Opening payment gateway...";  
  
    const handler = PaystackPop.setup({  
      key: "pk_live_bb0c7b83bfdbd0c9990e2c7f7fd73a86d4821a00", // üî¥ Replace with your live key  
      email: whatsapp + "@flexicbt.com",  
      amount: 500 * 100, // in kobo  
      currency: "NGN",  
  
      callback: async function(response) {  
        status.textContent = "‚úÖ Payment successful. Generating PIN...";  
  
        try {  
          const pin = "FT-" + Math.random().toString(36).substring(2,8).toUpperCase();  
  
          // Save to Firestore  
          await db.collection("subscriptions").doc(whatsapp).set({  
            whatsapp: whatsapp,  
            pin: pin,  
            paid: true,  
            used: false,  
            reference: response.reference,  
            createdAt: firebase.firestore.FieldValue.serverTimestamp()  
          });  
  
          status.innerHTML = `  
            <strong>PAYMENT CONFIRMED</strong><br><br>  
            WhatsApp Number:<br>  
            <b>${whatsapp}</b><br><br>  
            CBT PIN:<br>  
            <b style="font-size:20px">${pin}</b><br><br>  
            You can now access the CBT exam.  
          `;  
        } catch (err) {  
          console.error(err);  
          status.textContent = "‚ùå Payment saved but failed to store PIN. Try again later.";  
        }  
      },  
  
      onClose: function() {  
        status.textContent = "‚ùå Payment cancelled";  
      }  
    });  
  
    handler.openIframe();  
  }  
  
  // Bind button  
  document.getElementById("payBtn").addEventListener("click", pay);  
</script>  
  
</body>  
</html>
